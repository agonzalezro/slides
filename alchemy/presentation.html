<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>SQLAlchemy 0.7</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="file:///home/alex/.virtualenvs/landslide/src/landslide/src/landslide/themes/default/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="file:///home/alex/.virtualenvs/landslide/src/landslide/src/landslide/themes/light/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="file:///home/alex/.virtualenvs/landslide/src/landslide/src/landslide/themes/default/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>SQLAlchemy 0.7</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              1/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>History</h1></header>
            
            
            <section><ul>
<li>
<p>0.5.x: mostly rewritten + ORM extended + joins improved + easier session
management</p>
<ul>
<li>0.5.8: first important performance improvements</li>
</ul>
</li>
<li>
<p>0.6.x: cleaner naming convention + changes in expression evaluations +
new schema capatibilities + inspecto API</p>
<ul>
<li>30% improvement after refactor of internal components</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              2/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Enhancements in speed</h1></header>
            
            
            <section><ul>
<li>Performance</li>
<li>Optimizations in flush processing:<ul>
<li>calls to cursor.execute for large bulk of inserts can event be cut in half</li>
</ul>
</li>
<li>Simplified codepaths:<ul>
<li>many-to-one references</li>
<li>composite columns</li>
</ul>
</li>
<li><a href="http://www.sqlalchemy.org/trac/wiki/07Migration#SpeedEnhancements">...</a></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              3/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Enhancements in general</h1></header>
            
            
            <section><ul>
<li>Ordering: <code>.nullfirst()</code> &amp; <code>nulllast()</code></li>
<li>Indexes could be created inside the table definition</li>
<li><code>.count()</code> more efficient and will work in more complex circunstances</li>
<li>Pickable types are non-mutable by default, same for composites</li>
<li><a href="http://www.sqlalchemy.org/trac/wiki/07Migration">...</a></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              4/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Events</h1></header>
            
            
            <section><h2>For specific inner operations</h2>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">def</span> <span class="nf">my_on_connect</span><span class="p">(</span><span class="n">dbapi_con</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
<span class="lineno"> 2</span>     <span class="k">print</span> <span class="s">&quot;New DBAPI connection:&quot;</span><span class="p">,</span> <span class="n">dbapi_con</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
<span class="lineno"> 5</span>     <span class="k">return</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;ed&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">dbname</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="n">my_pool</span> <span class="o">=</span> <span class="n">QueuePool</span><span class="p">(</span><span class="n">connect</span><span class="p">)</span>
<span class="lineno"> 8</span> <span class="n">my_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;postgresql://ed@localhost/test&#39;</span><span class="p">)</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="c"># associate listener with all instances of Pool</span>
<span class="lineno">11</span> <span class="n">listen</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s">&#39;connect&#39;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span>
<span class="lineno">12</span> 
<span class="lineno">13</span> <span class="c"># associate listener with all instances of Pool</span>
<span class="lineno">14</span> <span class="c"># via the Engine class</span>
<span class="lineno">15</span> <span class="n">listen</span><span class="p">(</span><span class="n">Engine</span><span class="p">,</span> <span class="s">&#39;connect&#39;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span>
<span class="lineno">16</span> 
<span class="lineno">17</span> <span class="c"># associate listener with my_pool</span>
<span class="lineno">18</span> <span class="n">listen</span><span class="p">(</span><span class="n">my_pool</span><span class="p">,</span> <span class="s">&#39;connect&#39;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span>
<span class="lineno">19</span> 
<span class="lineno">20</span> <span class="c"># associate listener with my_engine.pool</span>
<span class="lineno">21</span> <span class="n">listen</span><span class="p">(</span><span class="n">my_engine</span><span class="p">,</span> <span class="s">&#39;connect&#39;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              5/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Events</h1></header>
            
            
            <section><h2>Raised by changes in the objects</h2>
<div class="highlight"><pre><span class="lineno">1</span> <span class="k">def</span> <span class="nf">validate_phone</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">oldvalue</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
<span class="lineno">2</span>     <span class="sd">&quot;&quot;&quot;Strip non-numeric characters from a phone number&quot;&quot;&quot;</span>
<span class="lineno">3</span> 
<span class="lineno">4</span>     <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(?![0-9])&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="lineno">5</span> 
<span class="lineno">6</span> <span class="c"># setup listener on UserContact.phone attribute, instructing</span>
<span class="lineno">7</span> <span class="c"># it to use the return value</span>
<span class="lineno">8</span> <span class="n">listen</span><span class="p">(</span><span class="n">UserContact</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="s">&#39;set&#39;</span><span class="p">,</span> <span class="n">validate_phone</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              6/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Hybrid properties and methods</h1></header>
            
            
            <section><h2>Example #1: evaluation &amp; query</h2>
<p>Given this class:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">Interval</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="lineno"> 2</span>     <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;interval&#39;</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span>     <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="lineno"> 5</span>     <span class="n">start</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="lineno"> 6</span>     <span class="n">end</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="lineno"> 9</span>         <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
<span class="lineno">10</span>         <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
<span class="lineno">11</span> 
<span class="lineno">12</span>     <span class="nd">@hybrid_property</span>
<span class="lineno">13</span>     <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">14</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
<span class="lineno">15</span> 
<span class="lineno">16</span>     <span class="nd">@hybrid_method</span>
<span class="lineno">17</span>     <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point</span><span class="p">):</span>
<span class="lineno">18</span>         <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">point</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">point</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              7/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Hybrid properties and methods</h1></header>
            
            
            <section><h2>Example #1: evaluation &amp; query</h2>
<p>We can access to the properties or filter them:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">Interval</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno"> 2</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">i1</span><span class="o">.</span><span class="n">length</span>
<span class="lineno"> 3</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">Interval</span><span class="o">.</span><span class="n">length</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">Interval</span><span class="o">.</span><span class="n">length</span>
<span class="lineno"> 6</span> <span class="n">interval</span><span class="o">.</span><span class="s">&quot;end&quot;</span> <span class="o">-</span> <span class="n">interval</span><span class="o">.</span><span class="n">start</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Interval</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Interval</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno"> 9</span> <span class="n">SELECT</span> <span class="n">interval</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">interval_id</span><span class="p">,</span> <span class="n">interval</span><span class="o">.</span><span class="n">start</span> <span class="n">AS</span> <span class="n">interval_start</span><span class="p">,</span>
<span class="lineno">10</span> <span class="n">interval</span><span class="o">.</span><span class="s">&quot;end&quot;</span> <span class="n">AS</span> <span class="n">interval_end</span>
<span class="lineno">11</span> <span class="n">FROM</span> <span class="n">interval</span>
<span class="lineno">12</span> <span class="n">WHERE</span> <span class="n">interval</span><span class="o">.</span><span class="s">&quot;end&quot;</span> <span class="o">-</span> <span class="n">interval</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="p">:</span><span class="n">param_15</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              8/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Hybrid properties and methods</h1></header>
            
            
            <section><h2>Example #2: different behaviour querying and evaluating</h2>
<p>We can also determine different behaviours if you are querying or evaluating:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">class</span> <span class="nc">Interval</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 4</span>     <span class="c"># ...</span>
<span class="lineno"> 5</span>     <span class="nd">@hybrid_property</span>
<span class="lineno"> 6</span>     <span class="k">def</span> <span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 7</span>         <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>     <span class="nd">@radius.expression</span>
<span class="lineno">10</span>     <span class="k">def</span> <span class="nf">radius</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
<span class="lineno">11</span>         <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>

<p>Will create use the abs function of SQL when you are querying:</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Interval</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Interval</span><span class="o">.</span><span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
<span class="lineno">2</span> <span class="n">SELECT</span> <span class="n">interval</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">interval_id</span><span class="p">,</span> <span class="n">interval</span><span class="o">.</span><span class="n">start</span> <span class="n">AS</span> <span class="n">interval_start</span><span class="p">,</span>
<span class="lineno">3</span>     <span class="n">interval</span><span class="o">.</span><span class="s">&quot;end&quot;</span> <span class="n">AS</span> <span class="n">interval_end</span>
<span class="lineno">4</span> <span class="n">FROM</span> <span class="n">interval</span>
<span class="lineno">5</span> <span class="n">WHERE</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interval</span><span class="o">.</span><span class="s">&quot;end&quot;</span> <span class="o">-</span> <span class="n">interval</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">:</span><span class="n">abs_1</span> <span class="o">&gt;</span> <span class="p">:</span><span class="n">param_1</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              9/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Hybrid properties and methods</h1></header>
            
            
            <section><h2>Example #3: custom comparators</h2>
<p>Given the classes:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">CaseInsensitiveComparator</span><span class="p">(</span><span class="n">Comparator</span><span class="p">):</span>
<span class="lineno"> 2</span>     <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="lineno"> 3</span>         <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__clause_element__</span><span class="p">())</span> <span class="o">==</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="k">class</span> <span class="nc">SearchWord</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="lineno"> 6</span>     <span class="c"># ...</span>
<span class="lineno"> 7</span>     <span class="nd">@hybrid_property</span>
<span class="lineno"> 8</span>     <span class="k">def</span> <span class="nf">word_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 9</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="lineno">10</span> 
<span class="lineno">11</span>     <span class="nd">@word_insensitive.comparator</span>
<span class="lineno">12</span>     <span class="k">def</span> <span class="nf">word_insensitive</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
<span class="lineno">13</span>         <span class="k">return</span> <span class="n">CaseInsensitiveComparator</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">word</span><span class="p">)</span>
</pre></div>

<p>The use of the current comparator will result in:</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SearchWord</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">word_insensitive</span><span class="o">=</span><span class="s">&quot;Trucks&quot;</span><span class="p">)</span>
<span class="lineno">2</span> <span class="n">SELECT</span> <span class="n">searchword</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">searchword_id</span><span class="p">,</span> <span class="n">searchword</span><span class="o">.</span><span class="n">word</span> <span class="n">AS</span> <span class="n">searchword_word</span>
<span class="lineno">3</span> <span class="n">FROM</span> <span class="n">searchword</span>
<span class="lineno">4</span> <span class="n">WHERE</span> <span class="n">lower</span><span class="p">(</span><span class="n">searchword</span><span class="o">.</span><span class="n">word</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(:</span><span class="n">lower_1</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              10/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Mutation tracking</h1></header>
            
            
            <section><ul>
<li>"support for tracking of in-place changes to scalar values, which are
  propagated into ORM change events on owning parent objects</li>
<li>
<p>replaces the <code>MutableType</code> class as well as <code>mutable=True</code> setting:</p>
<ul>
<li>
<p>scalar case: jsonized properties (this will <strong>not</strong> raise an update
  event)</p>
<p><code>instance.data['key'] = 1</code></p>
</li>
<li>
<p>composite case: a Point object</p>
<p><code>instance.point.x = 1</code></p>
</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              11/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Mutation tracking</h1></header>
            
            
            <section><h2>Example #1: Auxiliar class for the example</h2>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">TypeDecorator</span><span class="p">,</span> <span class="n">VARCHAR</span>
<span class="lineno"> 2</span> <span class="kn">import</span> <span class="nn">json</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span> <span class="k">class</span> <span class="nc">JSONEncodedDict</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
<span class="lineno"> 5</span>     <span class="s">&quot;Represents an immutable structure as a json-encoded string.&quot;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>     <span class="n">impl</span> <span class="o">=</span> <span class="n">VARCHAR</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>     <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
<span class="lineno">10</span>         <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="lineno">11</span>             <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="lineno">12</span>         <span class="k">return</span> <span class="n">value</span>
<span class="lineno">13</span> 
<span class="lineno">14</span>     <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
<span class="lineno">15</span>         <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="lineno">16</span>             <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="lineno">17</span>         <span class="k">return</span> <span class="n">value</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              12/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Mutation tracking</h1></header>
            
            
            <section><h2>Example #1: Replace the usage of plain Python dictionaries with a dict subclass that implements the <code>Mutable</code> mixin</h2>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">MutationDict</span><span class="p">(</span><span class="n">Mutable</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="lineno"> 2</span>     <span class="nd">@classmethod</span>
<span class="lineno"> 3</span>     <span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="lineno"> 4</span>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MutationDict</span><span class="p">):</span>
<span class="lineno"> 5</span>             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="lineno"> 6</span>                 <span class="k">return</span> <span class="n">MutationDict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>             <span class="c"># this call will raise ValueError</span>
<span class="lineno"> 9</span>             <span class="k">return</span> <span class="n">Mutable</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="lineno">10</span>         <span class="k">else</span><span class="p">:</span>
<span class="lineno">11</span>             <span class="k">return</span> <span class="n">value</span>
<span class="lineno">12</span> 
<span class="lineno">13</span>     <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="lineno">14</span>         <span class="nb">dict</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="lineno">15</span>         <span class="bp">self</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>
<span class="lineno">16</span> 
<span class="lineno">17</span>     <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="lineno">18</span>         <span class="nb">dict</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="lineno">19</span>         <span class="bp">self</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              13/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Mutation tracking</h1></header>
            
            
            <section><h2>Example #1: Using it</h2>
<p>Our model:</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="lineno">4</span> 
<span class="lineno">5</span> <span class="k">class</span> <span class="nc">MyDataClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="lineno">6</span>     <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;my_data&#39;</span>
<span class="lineno">7</span>     <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="lineno">8</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">MutationDict</span><span class="o">.</span><span class="n">as_mutable</span><span class="p">(</span><span class="n">JSONEncodedDict</span><span class="p">))</span>
</pre></div>

<p>Show me the code!</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="lineno">4</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">MyDataClass</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;value1&#39;</span><span class="p">:</span><span class="s">&#39;foo&#39;</span><span class="p">})</span>
<span class="lineno">5</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
<span class="lineno">6</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="lineno">7</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">m1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;value1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bar&#39;</span>
<span class="lineno">8</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">assert</span> <span class="n">m1</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">dirty</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              14/15
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 0.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Brainstorming!</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="0.md">0.md</a>
            </aside>
            
            <aside class="page_number">
              15/15
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">SQLAlchemy 0.7</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">History</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">Enhancements in speed</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">Enhancements in general</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">Events</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Events</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">Hybrid properties and methods</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Hybrid properties and methods</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">Hybrid properties and methods</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">Hybrid properties and methods</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">Mutation tracking</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">Mutation tracking</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Mutation tracking</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Mutation tracking</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">Brainstorming!</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>